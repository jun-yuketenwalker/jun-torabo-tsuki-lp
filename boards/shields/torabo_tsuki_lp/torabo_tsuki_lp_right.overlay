#include "torabo_tsuki_lp.dtsi"
#include <input/processors.dtsi>
#include <dt-bindings/zmk/input_transform.h>
#include <dt-bindings/input/input-event-codes.h>

/ {
    // 縦スクロール専用マッパー（横スクロール無効化）
    vertical_scroll_mapper: vertical_scroll_mapper {
        compatible = "zmk,input-processor-code-mapper";
        #input-processor-cells = <0>;
        type = <INPUT_EV_REL>;
        // Y軸のみをスクロールに変換（X軸は無視）
        map = <INPUT_REL_Y INPUT_REL_WHEEL>;
    };
};

&trackball_listener {
    input-processors =
        <&zip_xy_transform (INPUT_TRANSFORM_X_INVERT | INPUT_TRANSFORM_Y_INVERT)>,
        <&zip_temp_layer 4 10000>;  // タイムアウトを10秒に変更
    
    // レイヤー5でスクロールモード（縦方向のみ）
    scroll_layer {
        layers = <5>;
        input-processors = <&vertical_scroll_mapper>;
    };
};

// マウスボタンの位置を除外（それ以外のキーを押すとレイヤー4解除）
&zip_temp_layer {
    excluded-positions = <33 34 35 47 49>;  // MB1, MB3, MB2, MB4, MB5の位置
};

&size_s_transform {
    col-offset = <7>;
};

&size_m_transform {
    col-offset = <7>;
};

&size_l_transform {
    col-offset = <7>;
};
